<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MTMA-Web – Multimedia ta'lim monitoring tizimi</title>

    <!-- Bootstrap 5 CSS -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #f5f6fa;
        }
        .navbar-brand span {
            font-weight: 600;
            letter-spacing: .03em;
        }
        .card-stat {
            border: none;
            border-radius: 0.9rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            transition: transform .15s ease, box-shadow .15s ease;
        }
        .card-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.09);
        }
        .card-stat h3 {
            font-weight: 700;
        }
        .badge-pill {
            border-radius: 999px;
        }
        footer {
            font-size: .85rem;
        }
        .chart-container {
            position: relative;
            height: 260px;
        }
        .author-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #0d6efd22;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #0d6efd;
            font-size: 1.3rem;
        }
    </style>
</head>

<body>

<!-- Yuqori navigatsiya paneli -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'dashboard' %}">
            <span>MTMA-Web</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarMain" aria-controls="navbarMain"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarMain">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <!-- Dashboard hozir aktiv sahifa -->
                    <a class="nav-link active" aria-current="page"
                       href="{% url 'dashboard' %}">Dashboard</a>
                </li>
                <li class="nav-item">
                    <!-- Bu orqali Tashkilot sozlamalariga qaytasiz -->
                    <a class="nav-link" href="{% url 'org_settings' %}">
                        Tashkilot sozlamalari
                    </a>
                </li>
            </ul>
            <span class="navbar-text text-light small">
                Multimediali ta'lim muhitini monitoring va tahlil qilish
            </span>
        </div>
    </div>
</nav>


<div class="container mb-4">

    <!-- Sarlavha va izoh -->
    <div class="row mb-3">
        <div class="col">
            <h1 class="h3 mb-1">Dashboard</h1>
<p class="text-muted mb-0">
    {{ org_name }} uchun multimediali ta'lim muhiti bo'yicha umumiy ko'rsatkichlar.
</p>

        </div>
    </div>

    <!-- Statistik kartalar -->
    <div class="row g-3 mb-4">
        <div class="col-md-3 col-sm-6">
            <div class="card card-stat">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted text-uppercase mb-1">Sinf / Lab soni</h6>
                            <h3 class="mb-0">{{ classroom_count }}</h3>
                        </div>
                        <span class="badge bg-primary badge-pill mt-1">TJI</span>
                    </div>
                    <p class="text-muted small mt-2 mb-0">
                        Jihozlanganlik tahlili uchun asosiy obyektlar.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card card-stat">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase mb-1">Multimedia darslar</h6>
                    <h3 class="mb-0">{{ lesson_count }}</h3>
                    <p class="text-muted small mt-2 mb-0">
                        Ma'ruza, laboratoriya va amaliy mashg'ulotlar soni.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card card-stat">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase mb-1">Talaba so'rovnomalari</h6>
                    <h3 class="mb-0">{{ survey_count }}</h3>
                    <p class="text-muted small mt-2 mb-0">
                        Qoniqish va samaradorlik bo'yicha to'ldirilgan anketalar.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card card-stat">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase mb-1">
                        Multimedia qo'llash (texnik)
                    </h6>
                    <h3 class="mb-0">{{ avg_multimedia_score }}</h3>
                    <p class="text-muted small mt-2 mb-0">
                        Darslarda multimedia resurslarini qo'llash bo'yicha o'rtacha ko'rsatkich.
                    </p>
                </div>
            </div>
        </div>
    </div>
<!-- Yangi karta: Umumiy tavsiya va xulosa -->
<div class="card border-0 shadow-sm mt-3">
    <div class="card-header bg-white">
        <strong>Umumiy tavsiya va xulosa</strong>
    </div>
    <div class="card-body">
        <p class="small text-muted mb-0">
            {{ summary_text }}
        </p>
    </div>
</div>

    <!-- Pastki qator: grafik + izoh + muallif -->
    <div class="row g-3">
        <!-- Grafik -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <strong>Jihozlanganlik dinamikasi</strong>
<div class="mt-4">
    <h6 class="mb-2">Dars turlari bo'yicha multimedia darslar taqsimoti</h6>
    <canvas id="lessonChart" height="120"></canvas>
</div>

                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="tjiChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- O'ng panel: qisqa izoh va muallif -->
        <div class="col-lg-4">
            <!-- Qisqa izoh -->
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-header bg-white">
                    <strong>Qisqa izoh</strong>
                </div>
                <div class="card-body">
                    <ul class="small text-muted mb-0">
                        <li>Dashboard ma'lumotlari real ma'lumotlar bazasidan olinadi.</li>
                        <li>Magistrlik ishida ushbu sahifadan screenshotlar, diagrammalar va tahliliy jadval sifatida foydalanish mumkin.</li>
                        <li>Keyinchalik filtrlar (fan, guruh, davr) va qo'shimcha grafiklar qo'shilishi rejalashtirilgan.</li>
                    </ul>
                </div>
            </div>

            <!-- Muallif haqida ma'lumot -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <strong>Loyiha muallifi</strong>
                </div>
                <div class="card-body d-flex">
                    <div class="author-avatar me-3">
                        TD
                    </div>
                    <div class="small text-muted">
                        <div class="fw-semibold text-dark">
                            Turdiyeva Dildora Xayrulla qizi
                        </div>
                        <div>
                            Magistratura talabasi, multimediali ta'lim resurslari va
                            ularni ta'lim jarayonida qo'llash samaradorligini baholash
                            bo'yicha ilmiy izlanishlar olib boradi.
                        </div>
                        <div class="mt-1">
                            Loyiha: <span class="fst-italic">
                            “Multimediali ta'lim resurslarini ta'lim jarayonida qo'llash
                            va jihozlanganlik darajasini aniqlash”
                            </span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>

<footer class="border-top py-3 mt-4">
    <div class="container d-flex flex-column flex-md-row justify-content-between">
        <span class="text-muted mb-1 mb-md-0">
            © 2025 MTMA-Web – Multimedia ta'lim monitoring tizimi
        </span>
        <span class="text-muted">
            Magistrlik dissertatsiyasi uchun tajriba platformasi
        </span>
    </div>
</footer>

<!-- Bootstrap JS bundle -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
  // Jihozlanganlik dinamikasi (line chart)
  const tjiLabels = {{ tji_labels_json|safe }};
  const tjiValues = {{ tji_values_json|safe }};

  const ctx1 = document.getElementById('tjiChart');
  if (ctx1) {
      new Chart(ctx1, {
          type: 'line',
          data: {
              labels: tjiLabels,
              datasets: [{
                  label: 'TJI (texnik jihozlanganlik indeksi, %)',
                  data: tjiValues,
                  tension: 0.3,
                  fill: false,
              }]
          },
          options: {
              responsive: true,
              scales: {
                  y: {
                      min: 0,
                      max: 100,
                      ticks: { stepSize: 10 }
                  }
              }
          }
      });
  }

  // YANGI GRAFIK: dars turlari bo'yicha taqsimot (bar chart)
  const lessonLabels = {{ lesson_labels_json|safe }};
  const lessonValues = {{ lesson_values_json|safe }};

  const ctx2 = document.getElementById('lessonChart');
  if (ctx2) {
      new Chart(ctx2, {
          type: 'bar',
          data: {
              labels: lessonLabels,
              datasets: [{
                  label: "Multimedia qo'llangan darslar soni",
                  data: lessonValues,
              }]
          },
          options: {
              responsive: true,
              scales: {
                  y: {
                      beginAtZero: true,
                      ticks: { stepSize: 5 }
                  }
              }
          }
      });
  }
</script>

</body>
</html>
